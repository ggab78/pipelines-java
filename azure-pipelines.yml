name: test
pool: Default
trigger: none
steps:
- task: PowerShell@2
  inputs:
    targetType: 'inline'
    script: |
      $install_folder = 'C:\Program Files\Java'
      $filename = Get-ChildItem -Path C:\IIQSoftware\Java\*.zip | Sort-Object -Property LastWriteTime -Descending | Select-Object -First 1
      Expand-Archive -Path $filename -DestinationPath $install_folder -Force
      $java_folder = Get-ChildItem -Path $install_folder -Directory | Sort-Object -Property LastWriteTime -Descending | Select-Object -First 1
      $java_home=$install_folder +"\"+ $java_folder
      Set-ItemProperty -Path 'Registry::HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Session Manager\Environment' -Name JAVA_HOME -Value $java_home
- task: PowerShell@2
  inputs:
    targetType: 'inline'
    script: |
      $install_folder = 'C:\Program Files\Apache Software Foundation'
      $oldTomcatFolderName="Tomcat 9.0_old"
      $newTomcatFolderName="Tomcat 9.0"
      $filename = Get-ChildItem -Path C:\IIQSoftware\Apache-Tomcat\*.zip | Sort-Object -Property LastWriteTime -Descending | Select-Object -First 1
      Rename-Item -Path "C:\Program Files\Apache Software Foundation\Tomcat 9.0" -NewName $oldTomcatFolderName
      Expand-Archive -Path $filename -DestinationPath $install_folder -Force
      $unzippedTomcatName = Get-ChildItem -Path $install_folder -Directory | Sort-Object -Property LastWriteTime -Descending | Select-Object -First 1
      Rename-Item -Path $install_folder\$unzippedTomcatName -NewName $newTomcatFolderName
      Move-Item -Path $install_folder\$oldTomcatFolderName\webapps\identityiq -Destination $install_folder\$newTomcatFolderName\webapps
      Remove-Item -Path $install_folder\$oldTomcatFolderName -Recurse
- script: |
    echo executing cmd script
    echo %CATALINA_HOME%
    cd "C:\Program Files\Apache Software Foundation\Tomcat 9.0\bin"
    tomcat9 //DS//tomcat9
    service.bat install tomcat9
    echo instling tomcat9
    echo %CATALINA_BASE%
    
